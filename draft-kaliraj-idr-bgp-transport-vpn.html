<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>BGP Transport VPNs</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Transport Class"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Transport RIB"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Transport Routing Instance"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Nexthop Resolution Scheme"/>
<link href="#rfc.section.7" rel="Chapter" title="7 BGP Transport-VPN Family NLRI"/>
<link href="#rfc.section.8" rel="Chapter" title="8 Comparison with other families using RFC-8277 encoding"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Protocol Procedures"/>
<link href="#rfc.section.10" rel="Chapter" title="10 OAM considerations"/>
<link href="#rfc.section.11" rel="Chapter" title="11 IANA Considerations"/>
<link href="#rfc.section.12" rel="Chapter" title="12 Security Considerations"/>
<link href="#rfc.section.13" rel="Chapter" title="13 Acknowledgements"/>
<link href="#rfc.references" rel="Chapter" title="14 Normative References"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.4.3 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Vairavakkalai, K., Venkataraman, N., and B. Rajagopalan" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-kaliraj-idr-bgp-transport-vpn-00" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-3-07" />
  <meta name="dct.abstract" content="This document specifies a mechanism, referred to as &quot;service mapping&quot;, to express association of overlay routes with underlay routes using BGP. The document describes a framework for service mapping, and specifies BGP protocol procedures that enable dissimination of the service mapping information that may span across administrative domains.  It makes it possible to advertise multiple tunnels to the same destination." />
  <meta name="description" content="This document specifies a mechanism, referred to as &quot;service mapping&quot;, to express association of overlay routes with underlay routes using BGP. The document describes a framework for service mapping, and specifies BGP protocol procedures that enable dissimination of the service mapping information that may span across administrative domains.  It makes it possible to advertise multiple tunnels to the same destination." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">Network Working Group</td>
  <td class="right">K. Vairavakkalai</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">N. Venkataraman</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">B. Rajagopalan</td>
</tr>
<tr>
  <td class="left">Expires: September 8, 2020</td>
  <td class="right">Juniper Networks, Inc.</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">March 07, 2020</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">BGP Transport VPNs<br />
  <span class="filename">draft-kaliraj-idr-bgp-transport-vpn-00</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document specifies a mechanism, referred to as "service mapping", to express association of overlay routes with underlay routes using BGP. The document describes a framework for service mapping, and specifies BGP protocol procedures that enable dissimination of the service mapping information that may span across administrative domains.  It makes it possible to advertise multiple tunnels to the same destination.</p>
<p>A new BGP transport address family is defined for this purpose that uses <a href="#RFC4364">BGP-VPN</a> <cite title="NONE">[RFC4364]</cite> technology and follows <a href="#RFC8277">MPLS-BGP</a> <cite title="NONE">[RFC8277]</cite> NLRI encoding. This new address family is called "Transport-VPN".</p>
<h1>
  <a>Requirements Language</a>
</h1>
<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">RFC 2119</a> <cite title="NONE">[RFC2119]</cite>.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 8, 2020.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<li>2.   <a href="#rfc.section.2">Terminology</a></li>
<li>3.   <a href="#rfc.section.3">Transport Class</a></li>
<li>4.   <a href="#rfc.section.4">Transport RIB</a></li>
<li>5.   <a href="#rfc.section.5">Transport Routing Instance</a></li>
<li>6.   <a href="#rfc.section.6">Nexthop Resolution Scheme</a></li>
<li>7.   <a href="#rfc.section.7">BGP Transport-VPN Family NLRI</a></li>
<li>8.   <a href="#rfc.section.8">Comparison with other families using RFC-8277 encoding</a></li>
<li>9.   <a href="#rfc.section.9">Protocol Procedures</a></li>
<li>10.   <a href="#rfc.section.10">OAM considerations</a></li>
<li>11.   <a href="#rfc.section.11">IANA Considerations</a></li>
<li>12.   <a href="#rfc.section.12">Security Considerations</a></li>
<li>13.   <a href="#rfc.section.13">Acknowledgements</a></li>
<li>14.   <a href="#rfc.references">Normative References</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> Introduction</h1>
<p id="rfc.section.1.p.1">To facilitate service mapping, the tunnels in a network can be grouped by the purpose they serve into a "Transport Class". The tunnels could be created using any signaling protocol, such as LDP, RSVP, BGP-LU or SPRING. The tunnels could also use native IP or IPv6, as long as the tunnels can carry MPLS payload. Tunnels may exist between different pair of end points. Multiple tunnels may exist between the same pair of end points.</p>
<p id="rfc.section.1.p.2">Thus, a Transport Class consists of tunnels created by many protocols terminating in various nodes, each satisfying the properties of the class. For example, a "Gold" transport class may consist of tunnels that traverse the shortest path with fast re-route protection, a "Silver" transport class may hold tunnels that traverse shortest paths without protection, a "To NbrAS Foo" transport class may hold tunnels that exit to neighboring AS Foo, and so on.</p>
<p id="rfc.section.1.p.3">The extensions specified in this document can be used to create a BGP transport tunnel that potentially spans domains, while preserving its Transport Class. Examples of domain are Autonomous System (AS), or IGP area. Within each domain, there is a second level underlay tunnel used by BGP to cross the domain. The second level underlay tunnels could be hetrogeneous: Each domain may use a different type of tunnel, or use a differnet signaling protocol. A domain boundary is demarcated by a rewrite of BGP nexthop to 'self' while re-advertising tunnel routes in BGP. The path uses MPLS label-switching when crossing inter-AS links and uses the native intra-AS tunnel of the desired transport class when traversing within a domain.</p>
<p id="rfc.section.1.p.4">Overlay routes carry sufficient indication of the Transport Class they should be encapsulated over. A "route resolution" procedure on the ingress node selects from the Transport Class an appropriate tunnel whose destination matches the nexthop of the overlay route. If the overlay route is carried in BGP, the protocol nexthop (or, PNH) is generally carried as an attribute of the route. The PNH of the overlay route is also referred to as "service endpoint". The service endpoint may exist in the same domain as the service ingress node or lie in a different domain, adjacent or non-adjacent.</p>
<p id="rfc.section.1.p.5">This document describes mechanisms to: </p>

<ul class="empty">
  <li>Model a "Transport Class" as "Transport RIB" on a router, consisting of tunnel ingress routes of a certain class.</li>
  <li>Enable service routes to resolve over an intended Transport Class by using the corresponding Transport RIB for finding nexthop reachability.</li>
  <li>Advertise tunnel ingress routes in a Transport RIB via BGP without any path hiding, using BGP VPN technology and Add-path. Such that overlay routes in the receiving domains can also resolve over tunnels of associated Transport Class.</li>
  <li>Provide a way for co-operating domains to reconcile between independently administered extended community namespaces, and interoperate between different transport signaling protocols in each domain.</li>
</ul>
<p id="rfc.section.1.p.6">In this document we focus mainly on MPLS LSPs as transport tunnels, but the mechanisms would work in similar manner for non-MPLS transport tunnels too, provided the tunnel can carry MPLS payload.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> Terminology</h1>
<p id="rfc.section.2.p.1">LSP: Label Switched Path</p>
<p id="rfc.section.2.p.2">TE : Traffic Engineering</p>
<p id="rfc.section.2.p.3">SN : Service Node</p>
<p id="rfc.section.2.p.4">BN : Border Node</p>
<p id="rfc.section.2.p.5">TN : Transport Node, P-router</p>
<p id="rfc.section.2.p.6">BGP-VPN : VPNs built using RFC4364 mechanisms</p>
<p id="rfc.section.2.p.7">RT : Route-Target extended community</p>
<p id="rfc.section.2.p.8">RD : Route-Distinguisher</p>
<p id="rfc.section.2.p.9">PNH : Protocol-Nexthop</p>
<p id="rfc.section.2.p.10">Service Family : BGP address family used for advertising routes for "data traffic", as opposed to tunnels</p>
<p id="rfc.section.2.p.11">Transport Family : BGP address family used for advertising tunnels, which are in turn used by service routes for resolution</p>
<p id="rfc.section.2.p.12">Transport Tunnel : A tunnel over which a service may place traffic.  These tunnels can be GRE, UDP, LDP, RSVP, or SR-TE</p>
<p id="rfc.section.2.p.13">Tunnel Domain : A domain of the network containing SN and BN, under a single administrative control that has a tunnel between SN and BN. An end-to-end tunnel spanning several adjacent tunnel domains can be created by "stitching" them together using labels.</p>
<p id="rfc.section.2.p.14">Transport Class : A group of transport tunnels offering the same type of service.</p>
<p id="rfc.section.2.p.15">Transport Class RT : A BGP-VPN Route-Target used to identify a specific Transport Class</p>
<p id="rfc.section.2.p.16">Transport RIB : At the SN and BN, a Transport Class has an associted Transport RIB that holds its tunnel routes.</p>
<p id="rfc.section.2.p.17">Transport RTI : A Routing Instance; container of Transport RIB, and associated Transport Class RT and RD.</p>
<p id="rfc.section.2.p.18">Transport-VPN : Set of Transport RTIs importing same Transport Class RT. These are inturn stitched together to span across tunnel domain boundaries using a mechanism similar to Inter-AS option-b to swap labels at BN (nexthop-self).</p>
<p id="rfc.section.2.p.19">Mapping Community : Community on a service route, that maps it to resolve over a Transport Class</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> Transport Class</h1>
<p id="rfc.section.3.p.1">A Transport Class is defined as a set of transport tunnels that share certain characteristics useful for underlay selection.</p>
<p id="rfc.section.3.p.2">On the wire, a transport class is represented as the Transport Class RT, which is a regular Route-Target extended community.</p>
<p id="rfc.section.3.p.3">A Transport Class is configured at SN and BN, along with attributes like RD and Route-Target. Creation of a Transport Class instantiates the associated Transport RIB and a Transport routing instance to contain them all.</p>
<p id="rfc.section.3.p.4">The operator may configure a BN to classify a tunnel into an appropriate Transport Class, which causes the tunnel's ingress routes to be installed in the corresponding Transport RIB. These tunnel routes may then be advertised into BGP.</p>
<p id="rfc.section.3.p.5">Alternatively, a router receiving the transport routes in BGP with appropriate signaling information can associate those ingress routes to the appropriate Transport Class. E.g. for Transport-VPN family(SAFI TBD) routes, the Transport Class RT indicates the Transport Class. For BGP-LU family(SAFI 4) routes, import policy based on Communities or inter-AS source-peer may be used to place the route in the desired Transport Class.</p>
<p id="rfc.section.3.p.6">When the ingress route is received via <a href="#SRTE">SRTE</a> <cite title="NONE">[SRTE]</cite>, which encodes the Transport Class as an integer "Color" in the NLRI as "Color:Endpoint", the Color can be mapped to a Transport Class during import processing. The Color could map to a Community, or Route-Target that installs the ingress route for "Endpoint" in the appropriate Transport RIB. The SRTE route when advertised out to BGP speakers will then be advertised in Transport-VPN family with Transport Class RT and a new label. The MPLS swap route thus installed for the new label will pop the label and deliver decapsulated-traffic into the path determined by SRTE route.</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> Transport RIB</h1>
<p id="rfc.section.4.p.1">A Transport RIB is a routing-only RIB that is not installed in forwarding path. However, the routes in this RIB are used to resolve reachability of overlay routes' PNH. Transport RIB is created when the Transport Class it represents is configured.</p>
<p id="rfc.section.4.p.2">Overlay routes that want to use a specific Transport Class confine the scope of nexthop resolution to the set of routes contained in the corresponding Transport RIB. This Transport RIB is the "Routing Table" referred in <a href="https://www.rfc-editor.org/rfc/rfc4271#section-9.1.2.1">Section 9.1.2.1 RFC4271</a></p>
<p id="rfc.section.4.p.3">Routes in a Transport RIB are exported out in 'Transport-VPN' address family.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> Transport Routing Instance</h1>
<p id="rfc.section.5.p.1">A BGP VPN routing instance that is a container for the Transport RIBs. It imports, and exports routes in this RIB with Transport Class RT. Tunnel destination addresses in this routing instance's context come from the "provider namespace". This is different from user VRFs for e.g., which contain prefixes in "customer namespace"</p>
<p id="rfc.section.5.p.2">The Transport Routing instance uses the RD and RT configured for the Transport Class.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> Nexthop Resolution Scheme</h1>
<p id="rfc.section.6.p.1">An implementation may provide an option for the service route to resolve over less preferred Transport Classes, should the resolution over preferred, or "primary" Transport Class fail.</p>
<p id="rfc.section.6.p.2">To accomplish this, the set of service routes may be associated with a user-configured "resolution scheme", which consists of the primary Transport Class, and an ordered list of fallback Transport Classes.</p>
<p id="rfc.section.6.p.3">A community called as "Mapping Community" is configured for a "resolution scheme". A Mapping community maps to exactly one resolution scheme.</p>
<p id="rfc.section.6.p.4">When a resolution scheme comprises of a primary Transport Class without any fallback, the Transport Class RT associated with the primary Transport Class is used as the Mapping Community.</p>
<p id="rfc.section.6.p.5">A BGP service route is associated with a resolution scheme during import processing. The import processing matches against "Mapping Community" on the service route and determines the resolution scheme that should be used when resolving the route's PNH. If the route contains more than one Mapping Communities, the first one mapping to a resolution scheme is chosen.</p>
<p id="rfc.section.6.p.6">A transport route received in BGP Transport-VPN family should use a resolution scheme that contains only the primary Transport Class without any fallbacks. The primary Transport Class is identified by the Transport Class RT carried on the route. Thus Transport Class RT serves as the Mapping Community for Transport-VPN routes.</p>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> BGP Transport-VPN Family NLRI</h1>
<p id="rfc.section.7.p.1">The Transport-VPN family will use the existing AFI of IPv4 or IPv6, and a new SAFI TBD "Transport-VPN" that will apply to both IPv4 and IPv6 AFIs.</p>
<p id="rfc.section.7.p.2">The "Transport-VPN" SAFI NLRI itself is encoded as specified in <a href="#RFC8277">https://tools.ietf.org/html/rfc8277#section-2</a> <cite title="NONE">[RFC8277]</cite>.</p>
<p id="rfc.section.7.p.3">When AFI is IPv4 the "Prefix" portion of Transport-VPN family NLRI consists of an 8-byte RD followed by an IPv4 prefix. When AFI is IPv6 the "Prefix" consists of an 8-byte RD followed by an IPv6 prefix.</p>
<p id="rfc.section.7.p.4">Attributes on a Transport-VPN route include the Route-Target extended community, which is used to leak the route into the right Transport RIBs on SNs and BNs in the network.</p>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> Comparison with other families using RFC-8277 encoding</h1>
<p id="rfc.section.8.p.1">SAFI 128 (Inet-VPN) is a RF8277 encoded family that carries service prefixes in the NLRI, where the prefixes come from the customer namespaces, and are contexualized into separate user virtual service RIBs called VRFs, using RFC4364 procedures.</p>
<p id="rfc.section.8.p.2">SAFI 4 (BGP-LU) is a RFC8277 encoded family that carries transport prefixes in the NLRI, where the prefixes come from the provider namespace.</p>
<p id="rfc.section.8.p.3">SAFI TBD (Transport-VPN) is a RFC8277 encoded family that carries transport prefixes in the NLRI, where the prefixes come from the provider namespace, but are contexualized into separate Transport RIBs, using RFC4364 procedures.</p>
<p id="rfc.section.8.p.4">It is worth noting that SAFI 128 has been used to carry transport prefixes in "L3VPN Inter-AS Carrier's carrier" scenario, where BGP-LU/LDP prefixes in CsC VRF are advertised in SAFI 128 to the remote-end baby carrier.</p>
<p id="rfc.section.8.p.5">In this document a new AFI/SAFI is used instead of reusing SAFI 128 to carry these transport routes, because it is operationally advantageous to segregate transport and service prefixes into separate address families, RIBs. E.g. It allows to safely enable "per-prefix" label allocation scheme for Transport-VPN prefixes without affecting SAFI 128 service prefixes which may have huge scale. "per prefix" label allocation scheme keeps the routing churn local during topology changes.  A new family also facilitates having a different readvertisement path of the transport family routes in a network than the service route readvertisement path. viz. Service routes are exchanged over an EBGP multihop sessions between Autonomous systems with nexthop unchanged; whereas Transport-VPN routes are readvertised over EBGP single hop sessions with "nexthop-self" rewrite over inter-AS links.</p>
<p id="rfc.section.8.p.6">The Transport-VPN family is similar in vein to BGP-LU, in that it carries transport prefixes. The only difference is, it also carries in Route Target an indication of which Transport Class the transport prefix belongs to, and uses RD to disambiguate multiple instances of the same transport prefix in a BGP Update.</p>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> Protocol Procedures</h1>
<p id="rfc.section.9.p.1">This section summarizes the procedures followed by various nodes speaking Transport-VPN family</p>
<p id="rfc.section.9.p.2">Preparing the network for deploying Transport-VPNs</p>
<p/>

<ul class="empty">
  <li>Operator decides on the Transport Classes that exist in the network, and allocates a Route-Target to identify each Transport Class.</li>
  <li>Operator configures Transport Classes on the SNs and BNs in the network with unique Route-Distinguishers and Route-Targets.</li>
  <li>Implementations may provide automatic generation and assignment of RD, RT values for a transport routing instance; they should also provide a way to manually override the automatic mechanism, in order to deal with any conflicts that may arise with existing RD, RT values in the network.</li>
</ul>
<p id="rfc.section.9.p.4">Origination of Transport-VPN route:</p>
<p/>

<ul class="empty">
  <li>At the ingress node of the tunnel's egress domain, the tunneling protocols install routes in the Transport RIB associated with the Transport Class the tunnel belongs to. The ingress node then advertises this tunnel route into BGP as a Transport-VPN route with NLRI RD:TunnelEndpoint, attaching a Route-Target that identifies the Transport Class.</li>
  <li>Alternatively, the egress node of the tunnel i.e. the tunnel endpoint can originate the BGP Transport-VPN route, with NLRI RD:TunnelEndpoint and PNH TunnelEndpoint, which will resolve over the tunnel route at the ingress node. When the tunnel is up, the Transport-VPN route will become usable and get re-advertised.</li>
  <li>Unique RD is used by the originator of a Transport-VPN route to disambiguate the multiple BGP advertisements for a transport end point.</li>
</ul>
<p id="rfc.section.9.p.6">Ingress node receiving Transport-VPN route</p>

<ul class="empty">
  <li>On receiving a BGP Transport-VPN route with a PNH that is not directly connected, e.g. an IBGP-route, the Route-Target on the route indicates which Transport Class this route belongs to. The routes in the associated Transport RIB are used to resolve the received PNH. If there does not exist a route in the Transport RIB for the PNH, the Transport-VPN route is considered unusable, and MUST not be re-advertised further.</li>
</ul>
<p id="rfc.section.9.p.7">Border node readvertising Transport-VPN route with nexthop self:</p>

<ul class="empty">
  <li>The BN allocates an MPLS label to advertise upstream in Transport-VPN NLRI. The BN also installs an MPLS swap-route for that label that swaps the incoming label with a label received from the downstream BGP speaker, or pops the incoming label. And then pushes received traffic to the transport tunnel or direct interface that the Transport-VPN route's PNH resolved over.</li>
</ul>
<p id="rfc.section.9.p.8">Border node receiving Transport-VPN route on EBGP :</p>

<ul class="empty">
  <li>If the route is received with PNH that is known to be directly connected, e.g. EBGP single-hop peering address, the directly connected interface is checked for MPLS forwarding capability. No other nexthop resolution process is performed, as the inter-AS link can be used for any Transport Class.</li>
  <li>If the inter-AS links should honor Transport Class, then the BN should follow procedures of an Ingress node described above, and perform nexthop resolution process. The interface routes should be installed in the Transport RIB belonging to the associated Transport Class.</li>
</ul>
<p id="rfc.section.9.p.9">Avoiding path-hiding through Route Reflectors</p>

<ul class="empty">
  <li>When multiple BNs exist that advertise a RDn:PEn prefix to RRs, the RRs may hide all but one of the BNs, unless <a href="#RFC7911">ADDPATH</a> <cite title="NONE">[RFC7911]</cite> is used for the Transport-VPN family. This is similar to L3VPN option-B scenarios. Hence ADDPATH should be used for Transport-VPN family, to avoid path-hiding through RRs.</li>
</ul>
<p id="rfc.section.9.p.10">Ingress node receiving service route with mapping community</p>

<ul class="empty">
  <li>Service routes received with mapping community resolve using Transport RIBs determined by the resolution scheme. If the resolution process does not find an usable Transport-VPN route or tunnel route in any of the Transport RIBs, the service route MUST be considered unusable for forwarding purpose.</li>
</ul>
<p id="rfc.section.9.p.11">Coordinating between domains using different community namespaces.</p>

<ul class="empty">
  <li>Domains not agreeing on RT, RD, Mapping-community values because of independently administered community namespaces may deploy mechanisms to map and rewrite the Route-target values on domain boundaries, using per ASBR import policies. This is no different than any other BGP VPN family. Mechanisms employed in inter-AS VPN deployments may be used with the Transport-VPN family also.</li>
  <li>Though RD can also be rewritten on domain boundaries, deploying unique RDs is strongly recommended, because it helps in trouble shooting by uniquely identifying originator of a route, and avoids path-hiding.</li>
  <li>Future versions of this document may define a new format of Route-Target extended-community to carry Transport Class, to avoid collision with regular Route Target namespace used by service routes.</li>
</ul>
<h1 id="rfc.section.10"><a href="#rfc.section.10">10.</a> OAM considerations</h1>
<p id="rfc.section.10.p.1">TBD</p>
<h1 id="rfc.section.11"><a href="#rfc.section.11">11.</a> <a href="#IANA" id="IANA">IANA Considerations</a></h1>
<p id="rfc.section.11.p.1">This document makes following requests of IANA.</p>
<p id="rfc.section.11.p.2">New BGP SAFI code for "Transport-VPN". Value TBD.</p>
<p id="rfc.section.11.p.3">This will be used to create new AFI,SAFI pairs for IPv4, IPv6 Transport-VPN families. viz:</p>
<p/>

<ul>
  <li>"Inet, Transport-VPN". AFI/SAFI = "1/TBD" for carrying IPv4 Transport-VPN prefixes.</li>
  <li>"Inet6, Transport-VPN". AFI/SAFI = "2/TBD" for carrying IPv6 Transport-VPN prefixes.</li>
</ul>
<p id="rfc.section.11.p.5">Note to RFC Editor: this section may be removed on publication as an RFC.</p>
<h1 id="rfc.section.12"><a href="#rfc.section.12">12.</a> <a href="#Security" id="Security">Security Considerations</a></h1>
<p id="rfc.section.12.p.1">Mechanisms described in this document carry Transport routes in a new BGP address family. That minimizes possibility of these routes leaking outside the expected domain or mixing with service routes.</p>
<p id="rfc.section.12.p.2">When redistributing between SAFI 4 and SAFI TBD Transport-VPN routes, there is a possibility of SAFI 4 routes mixing with SAFI 1 service routes. To avoid such scenarios, it is recommended that implementations support keeping SAFI 4 routes in a separate transport RIB, distinct from service RIB that contain SAFI 1 service routes.</p>
<h1 id="rfc.section.13"><a href="#rfc.section.13">13.</a> <a href="#Acknowledgements" id="Acknowledgements">Acknowledgements</a></h1>
<p id="rfc.section.13.p.1">The authors thank Jeff Haas, John Scudder, Navaneetha Krishnan, Ravi M R, Chandrasekar Ramachandran, Shradha Hegde, Richard Roberts, Krzysztof Szarkowicz, John E Drake, Srihari Sangli, Vijay Kestur, Santosh Kolenchery for the valuable discussions.</p>
<p id="rfc.section.13.p.2">The decision to not reuse SAFI 128 and create a new address-family to carry these transport-routes was based on suggestion made by Richard Roberts and Krzysztof Szarkowicz.</p>
<h1 id="rfc.references"><a href="#rfc.references">14.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4271">[RFC4271]</b>
      </td>
      <td class="top"><a>Rekhter, Y.</a>, <a>Li, T.</a> and <a>S. Hares</a>, "<a href="http://tools.ietf.org/html/rfc4271">A Border Gateway Protocol 4 (BGP-4)</a>", RFC 4271, DOI 10.17487/RFC4271, January 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC4364">[RFC4364]</b>
      </td>
      <td class="top"><a>Rosen, E.</a> and <a>Y. Rekhter</a>, "<a href="http://tools.ietf.org/html/rfc4364">BGP/MPLS IP Virtual Private Networks (VPNs)</a>", RFC 4364, DOI 10.17487/RFC4364, February 2006.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7911">[RFC7911]</b>
      </td>
      <td class="top"><a>Walton, D.</a>, <a>Retana, A.</a>, <a>Chen, E.</a> and <a>J. Scudder</a>, "<a href="http://tools.ietf.org/html/rfc7911">Advertisement of Multiple Paths in BGP</a>", RFC 7911, DOI 10.17487/RFC7911, July 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC8277">[RFC8277]</b>
      </td>
      <td class="top"><a>Rosen, E.</a>, "<a href="http://tools.ietf.org/html/rfc8277">Using BGP to Bind MPLS Labels to Address Prefixes</a>", RFC 8277, DOI 10.17487/RFC8277, October 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="SRTE">[SRTE]</b>
      </td>
      <td class="top"><a>Previdi, S.</a>, "<a href="https://tools.ietf.org/html/draft-ietf-idr-segment-routing-te-policy-08">Advertising Segment Routing Policies in BGP</a>", 11 2019.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Kaliraj Vairavakkalai</span> 
	  <span class="n hidden">
		<span class="family-name">Vairavakkalai</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks, Inc.</span>
	<span class="adr">
	  <span>1133 Innovation Way,</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:kaliraj@juniper.net">kaliraj@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Natarajan Venkataraman</span> 
	  <span class="n hidden">
		<span class="family-name">Venkataraman</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks, Inc.</span>
	<span class="adr">
	  <span>1133 Innovation Way,</span>

	  <span class="vcardline">
		<span class="locality">Sunnyvale</span>,  
		<span class="region">CA</span> 
		<span class="code">94089</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:natv@juniper.net">natv@juniper.net</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Balaji Rajagopalan</span> 
	  <span class="n hidden">
		<span class="family-name">Rajagopalan</span>
	  </span>
	</span>
	<span class="org vcardline">Juniper Networks, Inc.</span>
	<span class="adr">
	  <span>Electra, Exora Business Park~Marathahalli - Sarjapur Outer Ring Road,</span>

	  <span class="vcardline">
		<span class="locality">Bangalore</span>,  
		<span class="region">KA</span> 
		<span class="code">560103</span>
	  </span>
	  <span class="country-name vcardline">India</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:balajir@juniper.net">balajir@juniper.net</a></span>

  </address>
</div>

</body>
</html>





Network Working Group                                   K. Vairavakkalai
Internet-Draft                                           N. Venkataraman
Intended status: Experimental                             B. Rajagopalan
Expires: July 1, 2020                             Juniper Networks, Inc.


                                                       December 29, 2019


                           BGP Transport VPNs
                draft-kaliraj-idr-bgp-transport-vpns-00

Abstract

   In a network, we may have multiple transport-tunnels (MPLS LSPs, IP-
   tunnels) from endpoints Sx to Dx.  There may also be multiple LSPs
   from a Sn to Dn.  Each tunnel may have a certain TE-characteristic.
   These TE-characterstics can be broadly classified into different
   transport-classes (e.g. gold, silver, toAS100 etc).

   This document describes how these tunnels can be advertised in BGP to
   speakers in the same or other domains, such that service-nodes that
   intend to use a specific transport-class can map traffic to these
   tunnels, irrespective of whether the destination service-endpoint is
   in same domain or a different domain.

   A new BGP transport address-family is defined for this purpose, that
   uses BGP-VPN technology (RFC 4364) and follows RLI-8277 NLRI
   encoding.  This new address-family is called "Transport VPNs".

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any



Vairavakkalai, et al.     Expires July 1, 2020                  [Page 1]

Internet-Draft             BGP Transport VPNs              December 2019


   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on July 1, 2020.

Copyright Notice

   Copyright (c) 2019 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   2.  Terminology . . . . . . . . . . . . . . . . . . . . . . . . .   3
   3.  Transport Class . . . . . . . . . . . . . . . . . . . . . . .   4
   4.  Transport RIB . . . . . . . . . . . . . . . . . . . . . . . .   5
   5.  Transport Routing Instance  . . . . . . . . . . . . . . . . .   6
   6.  Nexthop resolution scheme, and Mapping-community  . . . . . .   6
   7.  Transport-VPN BGP family - NLRI encoding  . . . . . . . . . .   6
   8.  Comparison with other families using RFC-8277 encoding  . . .   8
   9.  Protocol procedures . . . . . . . . . . . . . . . . . . . . .   9
   10. OAM considerations  . . . . . . . . . . . . . . . . . . . . .  11
   11. IANA Considerations . . . . . . . . . . . . . . . . . . . . .  11
   12. Security Considerations . . . . . . . . . . . . . . . . . . .  11
   13. Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  11
   14. References  . . . . . . . . . . . . . . . . . . . . . . . . .  11
   15. Normative References  . . . . . . . . . . . . . . . . . . . .  12
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  12

1.  Introduction

   In a network, the nature of the path from Sx to Dx can be broadly
   classified into different transport-classes (e.g. traversing-gold-
   LSPs, traversing-silver-LSPs, exiting-to-AS100, etc).  Multiple such
   paths could exist to a Dx.

   Further, different signaling protocols may be used in different
   tunnel-domains in the network.  Examples of tunnel-domain are an



Vairavakkalai, et al.     Expires July 1, 2020                  [Page 2]

Internet-Draft             BGP Transport VPNs              December 2019


   Autonomous-system or IGP-area.  A tunneling-domain boundary is
   demarcated by rewrite of BGP nexthop to self while re-advertising
   transport-routes in BGP.  This allows creating an end-to-end
   tunnelled path that belongs to a specific traffic-class and spans
   heterogenous tunnel types.  The path uses MPLS label-switching when
   crossing inter-AS links and uses the native intra-AS tunnel of the
   desired traffic-class, when traversing within a domain.

   The tunnel-endpoint also acts as "Service endpoint" and is carried as
   Nexthop (aka PNH) field in a BGP route update.  The Service-endpoint
   may exist in the same tunnel-domain as the Service Ingress-node or in
   an adjacent/non-adjacent domain.

   Service-routes may want to reach the service-endpoint (PNH) using a
   certain traffic-class, notwithstanding whether the service-endpoint
   is in the same domain or a different domain, or which protocol
   signals the tunnel in each domain.  This document describes
   mechanisms to:

      Model a "transport-class" as transport-rib, to collect tunnel
      ingress-routes of a certain class.

      Let service-routes resolve over an intended transport-class by
      using the corresponding transport-rib for finding nexthop
      reachability. aka. "service-mapping"

      Advertise tunnel ingress-routes in a "transport-rib" to other
      domains without any path-hiding, using BGP VPN technology and Add-
      path.  Such that services in those domains can also resolve over
      tunneled-paths in this transport-class.

      Provide a way for cooperating domains to reconcile between
      independently administered extended-community namespaces, and
      interoperate between different transport signaling-protocols in
      each domain.

   In this document we focus mainly on MPLS LSPs as transport-tunnels,
   but the mechanisms would work in similar manner for non-mpls
   transport-tunnels also.

2.  Terminology

   LSP: Label Switched Path

   TE : Traffic Engineering

   SN : Service Node




Vairavakkalai, et al.     Expires July 1, 2020                  [Page 3]

Internet-Draft             BGP Transport VPNs              December 2019


   BN : Border Node

   TN : Transport Node, P-router

   BGP-VPN : VPNs built using RFC-4364 mechanisms

   RT : Route-Target extended community

   RD : Route-Distinguisher

   PNH : Protocol-Nexthop

   Service-Famiily : BGP address-family that carries as NLRI, prefixes
   that are destination-field in data-traffic packets.

   Transport-Famiily : BGP address-family that carries as NLRI, prefixes
   that will be PNH in other Service-family routes

   Transport-Tunnel : Tunnel using a certain tunneling technology (e.g.
   GRE, UDP, LDP, RSVP, SRTE), can carry various payload-types

   Tunnel-Domain : A region of network (AS or intra-AS-region)
   containing SN, BN, and connected via a Transport-tunnel type.  We can
   use MPLS label-switching between these tunnel-domains, to stitch
   transport-tunnels of different-types.

   Transport-Class : A "set of TE-characteristics" of Transport-tunnels.
   aka Transport-Color.

   TransportClass-RT : A BGP-VPN Route-Target used to identify a
   specific "Transport-class"

   Transport-RIB : A transport-RTI RIB used to collect ingress-routes
   related to Tunnels of a certain transport-class

   Transport-VPN : Set of Transport-RTIs importing same TransportClass-
   RT.  Across tunnel-domain boundaries these are stitched together
   using option-b(nexthop-self, label-swap) mechanism.

   Mapping-Community : Community on a service route, that maps it to
   resolve over a Transport-class

3.  Transport Class

   A Transport-class is defined as collection of transport-paths that
   have the same nature.  E.g. a 'gold' transport-class could collect
   paths traversing over gold RSVP-LSPs, or a 'toAS100' traffic-class
   could collect BGP-LU paths exiting to a certain neighboring AS.



Vairavakkalai, et al.     Expires July 1, 2020                  [Page 4]

Internet-Draft             BGP Transport VPNs              December 2019


   On the wire, a transport-class is represented as the TransportClass-
   Route-Target, which is a regular Route-Target extended-community.

   A Transport-class is configured at the service-edge nodes and border-
   nodes, along with attributes like RD and Route-Target.  The
   transport-class instantiates a "transport-RIB" and "transport
   Routing-instance" at the routers.

   The operator may configure the service-edge router to classify a
   native-protocol (e.g. RSVP, GRE, Static-LSP) tunnel into appropriate
   transport-class.  The transport tunneling-protocols install the
   ingress-route for a tunnel in the appropriate transport-rib
   determined by the transport-class.  Each transport-class maps to a
   transport-rib.

   Alternatively the transport-routes received in BGP with appropriate
   signaling-information can associate those ingress-routes to the
   appropriate transport-class.  E.g. for TransportVpn family(SAFI 75)
   routes, the TransportClass-RT indicates the transport-class.  For
   BGP-LU family(SAFI 4) routes, import-policy based on Communities or
   inter-AS source-peer may be used to place the route in the desired
   transport-class.

   When the ingress-route is received via [BGP-SRTE], which encodes the
   transport-class as an integer "Color" in the NLRI : "Color:Endpoint",
   the color can be mapped to a transport-class community/Route-Target
   by the receiving router, so that the ingress-route for "Endpoint" is
   installed in the transport-rib for the transport-class.  The BGP-SRTE
   route when advertised out to BGP-speakers in other domains will be
   advertised in TransportVpn family with TransportClass-RT and a new
   label.  The MPLS swap-route thus installed for the new label will pop
   the label and deliver decapsulated-traffic into the path determined
   by SRTE route.

4.  Transport RIB

   A Transport-RIB is a routing-only RIB that is not installed to
   forwarding.  However the routes in this RIB are used to resolve
   reachability for PNH of service-routes.  Transport-ribs are created
   when the transport-classes are configured.

   Routes that want to use a specific transport-class confine the scope
   of nexthop-resolution to the set of routes in the transport-rib
   associated with the transport-class.

   Routes in a transport-rib are exported out in 'Transport VPN'
   address-family.




Vairavakkalai, et al.     Expires July 1, 2020                  [Page 5]

Internet-Draft             BGP Transport VPNs              December 2019


5.  Transport Routing Instance

   A BGP-VPN routing-instance that is a container of the transport-ribs.
   It imports, exports routes with TransportClass-RT.  Tunnel-
   destination addresses in this routing-instance's context come from
   the "provider-namespace".  This is different from user-VRFs, which
   contain prefixes in "customer-namespace"

   The transport routing-instance uses the RD and Routing-instance
   configured for the Transport-class.

6.  Nexthop resolution scheme, and Mapping-community

   The service-routes may use alternative transport-ribs for resolving
   PNHs, when resolution in a primary transport-rib fails.  Such ordered
   "set of transport-RIBs/classes" defined by user, is called a
   Resolution-scheme.  The order specifies the intended fallback among
   transport-classes.

   Operator can configure Resolution-schemes to match desired fallback
   resolution, along with import-policy that maps community to these
   resolution-schemes.

   Mapping-community: a community or "set of attributes" on the service-
   route that maps to a Resolution-scheme.  When a route is received
   with this attribute, it signifies the resolution-scheme to use when
   resolving the route's PNH.

7.  Transport-VPN BGP family - NLRI encoding

   The Transport-VPN family will use a new "AFI/SAFI = Inet/TransportVpn
   OR Inet6/TransportVpn".

   The NLRI encoding is exactly the same as RFC-4364 (AFI/SAFI = 1/128
   or 2/128). viz. as stated in Fig 1.

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |    Length     |                 Label                 |Rsrv |S|
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          RD                                   ~
   ~                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |                          Prefix                               ~
   ~                                                               |
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+




Vairavakkalai, et al.     Expires July 1, 2020                  [Page 6]

Internet-Draft             BGP Transport VPNs              December 2019


             Figure 1: TransportVpn NLRI

   - Length:

       The Length field consists of a single octet.  It specifies the
       length in bits of the remainder of the NLRI field.

       Note that the length will always be the sum of 20 (number of bits
       in Label field), plus 3 (number of bits in Rsrv field), plus 1
       (number of bits in S field), plus the length in bits of the
       prefix.

       In an MP_REACH_NLRI attribute whose SAFI is TBD, the prefix will
       be 96 bits or less if the AFI is 1 and will be 192 bits or less
       if the AFI is 2.

       As specified in [RFC4760], the actual length of the NLRI field
       will be the number of bits specified in the Length field,
       rounded up to the nearest integral number of octets.

   - Label:

       The Label field is a 20-bit field containing an MPLS label value
       (see [RFC3032]).

   - Rsrv:

       This 3-bit field SHOULD be set to zero on transmission and MUST
       be ignored on reception.

   - S:

       This 1-bit field MUST be set to one on transmission and MUST be
       ignored on reception.

   Attributes on a Transport-VPN route include the Route-target
   extended-community, which is used to leak the route into the right
   transport-ribs on service-nodes and border-nodes in the network.

   We use a new AFI/SAFI instead of re-using SAFI 128 to carry these
   transport-routes, because it is operationally advantageous to keep
   transport and service prefixes separate, and not mix in same address-
   family.  It allows to safely enable per-prefix-label allocation for
   transport-VPN prefixes while not affecting SAFI 128 service-prefixes.
   Also, transport-family re-advertisement path in a network would be
   different than service-route readvertisement path. viz.  Service-
   routes are exchanged over a EBGP multihop session between Autonomous-
   systems with nexthop unchanged; where-as transport-VPN routes will



Vairavakkalai, et al.     Expires July 1, 2020                  [Page 7]

Internet-Draft             BGP Transport VPNs              December 2019


   need to be readvertised over EBGP single-hop sessions with nexthop-
   self rewrite over inter-AS links.

8.  Comparison with other families using RFC-8277 encoding

   SAFI 128 (InetVpn) is a RFC-8277 encoded family, that carries
   service-prefixes in the NLRI, where the prefixes come from the
   customer namespaces, and are contexualized into separate user virtual
   service-RIBs called VRFs, using RFC-4364 procedures.

   SAFI 4 (BGP-LU) is a RFC-8277 encoded family, that carries transport-
   prefixes in the NLRI, where the prefixes come from the provider
   namespace.

   SAFI 75 (TransportVpn) is a RFC-8277 encoded family, that carries
   transport-prefixes in the NLRI, where the prefixes come from the
   provider namespace, but are contexualized into separate transport-
   RIBs, using RFC-4364 procedures.

   It is worth noting that SAFI 128 has been used to carry transport-
   prefixes in "L3VPN Inter-AS Carrier's carrier" scenario, where BGP-LU
   /LDP prefixes in CsC VRF are advertised in SAFI 128 to the remote-end
   baby carrier.

   In this document we use a new AFI/SAFI instead of re-using SAFI 128
   to carry these transport-routes, because it is operationally
   advantageous to keep transport and service prefixes separate, and not
   mix in same address-family or rib.  E.g. it allows to safely enable
   per-prefix-label allocation for transport-VPN prefixes while not
   affecting SAFI 128 service-prefixes which have huge-scale.  Also, re-
   advertisement path of transport-family routes in a network would be
   different than service-route readvertisement path. viz. Service-
   routes are exchanged over a EBGP multihop session between Autonomous-
   systems with nexthop unchanged; where-as transport-VPN routes are
   readvertised over EBGP single-hop sessions with nexthop-self rewrite
   over inter-AS links.

   This family TransportVpn is similar in vein to BGP-LU, in that it
   carries transport-prefixes.  The only difference is, it also carries
   indication (the RT) of which transport-class those transport-prefixes
   belong to, and has means (like RD) to disambiguate multiple instances
   of the same transport-prefix when carried in BGP update messages.









Vairavakkalai, et al.     Expires July 1, 2020                  [Page 8]

Internet-Draft             BGP Transport VPNs              December 2019


9.  Protocol procedures

   This section summarizes the procedures followed by various nodes
   speaking Transport-VPN family

   Preparing the network for deploying Transport-VPNs

      Operator decides on the Transport-Classes that exist in the
      network, and allocates a Route-Target to identify each Transport-
      Class.

      Operator configures Transport-Classes on the SNs and BNs in the
      network with unique Route-Distinguishers and Route-Targets.

      Implementations may provide automatic-generation and assignment of
      RD, RT values for a transport routing-instance; they should also
      provide a way to override the automatic mechanism, in order to
      deal with any conflicts that may arise with existing RD, RT values
      in the network.

   Origination of Transport-VPN route:

      At the ingress-node of the tunnel's home-domain, the tunneling
      protocols install routes in transport-rib associated with the
      transport-class the tunnel belongs to.  The ingress-node then
      advertises this tunnel-route into BGP as a Transport-VPN route,
      with NLRI RD:TunnelEndpoint, attaching a Route-Target that
      identifies the transport-class.

      Alternatively, the egress-node of the tunnel i.e. the tunnel-
      endpoint can originate the BGP Transport-VPN route, with NLRI
      RD:TunnelEndpoint and PNH=TunnelEndpoint, which will resolve over
      the tunnel-route at the ingress-node.  When the tunnel is up, the
      Transport-VPN route will become usable and get re-advertised.

   Ingress-node receiving transport-VPN route

      On receiving a BGP transport-vpn route with a PNH that is not
      directly connected, e.g. an IBGP-route, the Route-Target on the
      route indicates which transport-class this route belongs to.  The
      routes in the associated transport-rib are used to resolve the
      received PNH.  If there does not exist a route in the transport-
      rib for the PNH, the transport-vpn route is considered un-usable,
      and MUST not be re-advertised further.

   Border-node readvertising transport-VPN route with nexthop self:

      Allocates a MPLS label to advertise upstream in transport-vpn NLRI



Vairavakkalai, et al.     Expires July 1, 2020                  [Page 9]

Internet-Draft             BGP Transport VPNs              December 2019


      Installs a MPLS swap-route for that label, that pops the label and
      pushes received-traffic to the transport-tunnel or direct-
      interface that the transport-vpn route's PNH resolved over.

   Border-node receiving transport-VPN route on EBGP :

      If the route is received with PNH that is known to be directly
      connected, e.g. EBGP single-hop peering-address, the directly
      connected interface is checked for MPLS-forwarding capability.  No
      other nexthop resolution process is undergone, this assumes the
      inter-AS link can be used for any transport-class.

      If the inter-AS links need to be confined to be used for a
      specific transport-class, then the BN should follow procedures of
      an Ingress-node described above, and undergo nexthop resolution
      process.  The interface-routes should be installed in the
      transport-rib belonging to the associated transport-class.

   Avoiding path-hiding thru Route-reflectors

      When multiple BNs exist that advertise a RDn:PEn prefix to RRs,
      the RRs may hide all but one of the BNs, unless [ADDPATH] is used
      for the Transport-VPN family.  This is similar to L3VPN option-B
      scenarios.  Hence [ADDPATH] should be used for Transport-VPN
      family, to avoid path-hiding thru RRs.

   Ingress-node receiving service-route with Mapping community

      Service-routes received with Mapping-community resolve using
      transport-rib associated with the mapped transport-class.  If the
      resolution-process does not find an usable transport-vpn route or
      tunnel-route, the service-route MUST be considered un-usable for
      forwarding purpose.

   Coordinating between domains using different community namespaces.

      Domains not agreeing on RT, RD, Mapping-community values because
      of independently administered community namespaces may deploy
      mechanisms to map and rewrite the Route-target values on domain
      boundaries, using per ASBR import-policies.  This is no different
      than any other BGP VPN family.  The mechanisms employed in inter-
      AS VPN deployments may be used with the transport-vpn family also.

      Though RD can also be rewritten on domain boundaries, we recommend
      deploying unique RDs as much as feasible, because it helps in
      trouble-shooting by uniquely identifying originator of a route,
      and avoids path-hiding.




Vairavakkalai, et al.     Expires July 1, 2020                 [Page 10]

Internet-Draft             BGP Transport VPNs              December 2019


10.  OAM considerations

   TBD

11.  IANA Considerations

   This document makes following requests of IANA.

   New BGP SAFI code for "Transport-VPN".  Value 75.

   This will be used to create new AFI,SAFI pairs for IPv4, IPv6
   Transport-Vpn families. viz:

   o  "Inet, Transport-Vpn".  AFI/SAFI = "1/75" for carrying IPv4
      transport-VPN prefixes.

   o  "Inet6, Transport-Vpn".  AFI/SAFI = "2/75" for carrying IPv6
      transport-VPN prefixes.

   Note to RFC Editor: this section may be removed on publication as an
   RFC.

12.  Security Considerations

   Mechanisms described in this document dont have any adverse impact on
   security of a network.

13.  Acknowledgements

   The authors thank Jeff Haas, John Scudder, Navaneetha Krishnan, Ravi
   M R, Chandrasekar Ramachandran, Shradha Hegde, Richard Roberts,
   Krzysztof Szarkowicz, John E Drake, Srihari Sangli, Vijay Kestur,
   Santosh Kolenchery for the valuable discussions.

   The decision to not reuse SAFI 128 and create a new address-family to
   carry these transport-routes was based on suggestion made by Richard
   Roberts and Krzysztof Szarkowicz.

14.  References

   [RFC-4364] BGP/MPLS IP Virtual Private Networks (VPNs)

   [RFC-8277] Using BGP to Bind MPLS Labels to Address Prefixes

   [ADDPATH] RFC-7911 - Advertisement of Multiple Paths in BGP

   [BGP-SRTE] Advertising Segment Routing Policies in BGP, draft-ietf-
   idr-segment-routing-te-policy-08



Vairavakkalai, et al.     Expires July 1, 2020                 [Page 11]

Internet-Draft             BGP Transport VPNs              December 2019


15.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, DOI 10.17487/
              RFC2119, March 1997, <https://www.rfc-editor.org/info/
              rfc2119>.

Authors' Addresses

   Kaliraj Vairavakkalai
   Juniper Networks, Inc.
   1133 Innovation Way,
   Sunnyvale, CA  94089
   US

   Email: kaliraj@juniper.net


   Natarajan Venkataraman
   Juniper Networks, Inc.
   1133 Innovation Way,
   Sunnyvale, CA  94089
   US

   Email: kaliraj@juniper.net


   Balaji Rajagopalan
   Juniper Networks, Inc.
   Electra, Exora Business Park~Marathahalli - Sarjapur Outer Ring Road,
   Bangalore, KA  560103
   India

   Email: kaliraj@juniper.net

















Vairavakkalai, et al.     Expires July 1, 2020                 [Page 12]
